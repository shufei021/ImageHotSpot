!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).ImageHotSpot=e()}(this,(function(){"use strict";return class{constructor(t){this.container=null,this.canvas=null,this.isInit=!1,this.handleMouseDownFunc=t=>{},this.scale=1,this.hotImgWidth=0,this.hotImgHeight=0,this.options=t,this.init()}init(){if(this.container="string"==typeof this.options.el?document.querySelector(this.options.el):this.options.el,!this.container)throw new Error(`${this.options.el||""} container is not found`);this.options.addMode=this.options.addMode||"default",this.initDefaultProps(),this.initSquarePos(),!0!==this.options.customUpload&&this.resetInit()}initDefaultProps(){var t,e,s,i,o,n,l,r,a,c,h,d,u,p,v,f,m,x,g,b,y,w,q,j,z,T,$,O,E;const{size:P,width:M="8px",height:I="8px",borderColor:S="#1447FF",backgroundColor:N="#1447FF"}=(null===(t=this.options)||void 0===t?void 0:t.handle)||{},A=`position: absolute;border: 1px solid ${S};background-color: ${N};box-sizing: border-box;width: ${P||M};height: ${P||I};`;this.defaultProps={canvas:Object.assign({className:"hot-container",cssText:"width: 100%; height: 100%; position: relative; border: 1px dashed #ccc; box-sizing: border-box;"},(null===(s=null===(e=this.options)||void 0===e?void 0:e.style)||void 0===s?void 0:s.canvas)||{}),container:Object.assign({className:"hot-container",cssText:"width: 100%; height: 100%; position: relative;"},(null===(o=null===(i=this.options)||void 0===i?void 0:i.style)||void 0===o?void 0:o.container)||{}),square:Object.assign({className:"hot-square",cssText:`width: 88px; height: 88px; background-color: rgba(20, 71, 255, 0.2); border: 1px dashed ${S}; cursor: move; position: absolute; left: 0px; top: 0px; opacity: 1; box-sizing: border-box;`},(null===(l=null===(n=this.options)||void 0===n?void 0:n.style)||void 0===l?void 0:l.square)||{}),content:Object.assign({className:"hot-content",cssText:"display:none"},(null===(a=null===(r=this.options)||void 0===r?void 0:r.style)||void 0===a?void 0:a.content)||{}),lt:Object.assign({className:"lt",cssText:`${A}cursor: nw-resize;top: -4px;left: -4px;`},(null===(h=null===(c=this.options)||void 0===c?void 0:c.style)||void 0===h?void 0:h.lt)||{}),lm:Object.assign({className:"lm",cssText:`${A}cursor: e-resize;top: 50%;left: -4px;transform: translateY(-50%);`},(null===(u=null===(d=this.options)||void 0===d?void 0:d.style)||void 0===u?void 0:u.lm)||{}),lb:Object.assign({className:"lb",cssText:`${A}cursor: ne-resize;bottom: -4px;left: -4px;`},(null===(v=null===(p=this.options)||void 0===p?void 0:p.style)||void 0===v?void 0:v.lb)||{}),bm:Object.assign({className:"bm",cssText:`${A}cursor: n-resize;bottom: -4px;left: 50%;transform: translateX(-50%);`},(null===(m=null===(f=this.options)||void 0===f?void 0:f.style)||void 0===m?void 0:m.bm)||{}),br:Object.assign({className:"br",cssText:`${A}cursor: se-resize;bottom: -4px;right: -4px;`},(null===(g=null===(x=this.options)||void 0===x?void 0:x.style)||void 0===g?void 0:g.br)||{}),rm:Object.assign({className:"rm",cssText:`${A}cursor: e-resize;top: 50%;right: -4px;transform: translateY(-50%);`},(null===(y=null===(b=this.options)||void 0===b?void 0:b.style)||void 0===y?void 0:y.rm)||{}),tm:Object.assign({className:"tm",cssText:`${A}cursor: n-resize;top: -4px;left: 50%;transform: translateX(-50%);`},(null===(q=null===(w=this.options)||void 0===w?void 0:w.style)||void 0===q?void 0:q.tm)||{}),rt:Object.assign({className:"rt",cssText:`${A}cursor: ne-resize;top: -4px;right: -4px;`},(null===(z=null===(j=this.options)||void 0===j?void 0:j.style)||void 0===z?void 0:z.rt)||{}),seq:Object.assign({className:"hot-seq",cssText:"min-width: 14px; min-height: 14px; text-align: center; color: #fff; line-height: 14px; position: absolute; top: 0px; left: 0px; background-color: red; font-size: 10px;z-index:-1;cursor:default"},(null===($=null===(T=this.options)||void 0===T?void 0:T.style)||void 0===$?void 0:$.seq)||{}),del:Object.assign({className:"hot-del",cssText:"width: 16px; height: 16px; position: absolute; right: -20px; top: -20px; z-index: 2; cursor: pointer;"},(null===(E=null===(O=this.options)||void 0===O?void 0:O.style)||void 0===E?void 0:E.del)||{})}}initSquarePos(){this.squarePos=Object.assign({x:0,y:0,w:80,h:80},this.options.squarePos||{})}resetInit(){this.isInit=!0,this.generateContainer(),this.handleMouseDownFunc=this.handleMouseDown.bind(this),this.canvas.addEventListener("mousedown",this.handleMouseDownFunc)}generateContainer(){var t;const e=this.createElement("div",Object.assign({},this.defaultProps.canvas));null===(t=this.container)||void 0===t||t.appendChild(e),this.canvas=e}addHotArea({x:t=this.squarePos.x,y:e=this.squarePos.y,w:s=this.squarePos.w,h:i=this.squarePos.h}={},o){var n,l,r,a;if("default"===this.options.addMode||o){if(!this.canvas)return null===(l=null===(n=this.options)||void 0===n?void 0:n.beforeAdd)||void 0===l||l.call(n),Promise.reject(new Error("Please initialize the instance first"));if(!this.container)return Promise.reject(new Error("Please initialize the instance first"));const o=this.container.querySelectorAll(".hot-square").length+1,c=this.createHotSquare(o,{style:{left:parseFloat(t)+"px",top:parseFloat(e)+"px",width:parseFloat(s)+"px",height:parseFloat(i)+"px"}});return this.canvas.appendChild(c),null===(a=null===(r=this.options)||void 0===r?void 0:r.afterAdd)||void 0===a||a.call(r,{index:o,square:c}),Promise.resolve({index:o,square:c})}return Promise.reject(new Error("options addMode is not default"))}createHotSquare(t,e){return this.createElement("div",Object.assign(Object.assign({},this.defaultProps.square),e),[this.createElement("div",Object.assign({},this.defaultProps.content),this.createElement("div",Object.assign({},this.defaultProps.lt)),this.createElement("div",Object.assign({},this.defaultProps.lm)),this.createElement("div",Object.assign({},this.defaultProps.lb)),this.createElement("div",Object.assign({},this.defaultProps.bm)),this.createElement("div",Object.assign({},this.defaultProps.br)),this.createElement("div",Object.assign({},this.defaultProps.rm)),this.createElement("div",Object.assign({},this.defaultProps.rt)),this.createElement("div",Object.assign({},this.defaultProps.tm)),this.createElement("div",Object.assign({},this.defaultProps.del),this.createElement("div",{className:"lines",cssText:" width: 16px;height: 16px;position: relative;cursor: pointer;border-radius: 50%;background: #ff4b4b;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);display: flex;align-items: center;justify-content: center;"},[this.createElement("div",{className:"line",cssText:" position: absolute;height: 1px;width: 60%;background: white;border-radius: 1px;transition: all 0.3s ease;top: 50%;transform: translateY(-50%) rotate(45deg);"}),this.createElement("div",{className:"line",cssText:" position: absolute;height: 1px;width: 60%;background: white;border-radius: 1px;transition: all 0.3s ease;top: 50%;transform: translateY(-50%) rotate(-45deg);"})]))),this.createElement("div",Object.assign({},this.defaultProps.seq),t)])}createElement(t,...e){const s="object"!=typeof e[0]||Array.isArray(e[0])?{}:e.shift();let i=e.flat(1/0);const o=document.createElement(t);((t,e)=>{e.cssText&&(t.style.cssText=e.cssText,Reflect.deleteProperty(e,"cssText")),e.style&&("string"==typeof e.style?t.style.cssText=e.style:"object"==typeof e.style&&Object.assign(t.style,e.style),Reflect.deleteProperty(e,"style"))})(o,s);for(const[t,e]of Object.entries(s))if("className"!==t||"string"!=typeof e)if("htmlFor"!==t||"string"!=typeof e)if(/^on[A-Z]/.test(t)&&"function"==typeof e){const s=t.slice(2).toLowerCase();o.addEventListener(s,e)}else"style"!==t?"boolean"!=typeof e?o.setAttribute(t,e):e?o.setAttribute(t,""):o.removeAttribute(t):"object"==typeof e?Object.assign(o.style,e):"string"==typeof e&&(o.style.cssText=e);else o.setAttribute("for",e);else o.className=e;return i=i.flat(1/0).filter((t=>null!=t&&!1!==t)).map((t=>"string"==typeof t||"number"==typeof t?document.createTextNode(String(t)):t)),i.forEach((t=>{t instanceof Node?o.appendChild(t):console.warn("Invalid child element:",t)})),o}delHotArea(t){const e=t.closest(".hot-square");if(e){const t=1*e.querySelector(".hot-seq").innerText,s=()=>{e.remove(),this.resetHotSeq(t)};"function"==typeof this.options.beforeDel?this.options.beforeDel(t,e,s):s()}}resetHotSeq(t){if(!this.container)return;this.container.querySelectorAll(".hot-square").forEach((e=>{const s=e.querySelector(".hot-seq");if(s){const e=Number(s.innerText);e>t&&(s.innerText=String(e-1))}}))}handleMouseDown(t){if(t.preventDefault(),!this.canvas)return;const{target:e}=t,s=e.className,i=e.closest(".hot-del");if(i)return this.delHotArea(i);let o=null;if(["lt","lm","lb","bm","br","rm","rt","tm","hot-square"].includes(s)){const i="hot-square"===s?e:e.closest(".hot-square"),n=this.canvas.querySelector(".hot-active");n&&n.parentElement!==i&&(n.classList.remove("hot-active"),n.style.display="none"),o=i.querySelector(".hot-content"),o&&!o.classList.contains("hot-active")&&(o.classList.add("hot-active"),o.style.display="block",i.style.zIndex=String(this.getMaxZIndex()+1)),this.startDrag(t,i,s,o)}else if("hot-container"===s&&"manual"===this.options.addMode){const e=this.canvas.getBoundingClientRect(),s=e.left,i=e.top;let o=t.clientX-s,n=t.clientY-i;const l=this.createElement("div",{className:"hot-line",style:{left:o+"px",top:n+"px",width:"0px",height:"0px",border:"1px solid red",boxSizing:"border-box",position:"absolute"}});this.canvas.appendChild(l);let r=0,a=0;const c=l.offsetLeft,h=l.offsetTop,d=this.canvas.offsetWidth-c,u=this.canvas.offsetHeight-h,p=l.offsetWidth,v=l.offsetHeight;document.onmousemove=e=>{const{clientX:f,clientY:m}=e,x=t.clientX-f,g=t.clientY-m,b=f-s-o,y=m-i-n;let w=b,q=y;f<t.clientX?(w=p+x,w=w>c?c:w,o=f-s,o=o<0?0:o):w=b>d?d:b,m<t.clientY?(q=v+g,q=q>h?h:q,n=m-i,n=n<0?0:n):q=y>u?u:y,l.style.left=o+"px",l.style.top=n+"px",l.style.width=w+"px",l.style.height=q+"px",r=w,a=q},document.onmouseup=t=>{var e,s,i;l&&(null===(e=this.canvas)||void 0===e||e.removeChild(l));const c=()=>this.addHotArea({x:o+"px",y:n+"px",w:r+"px",h:a+"px"},!0);r>16&&a>16&&(null===(i=null===(s=this.options)||void 0===s?void 0:s.manualAdd)||void 0===i?void 0:i.call(s,c))&&c(),document.onmousemove=null,document.onmouseup=null}}}startDrag(t,e,s,i){var o,n;const{clientX:l,clientY:r}=t,a=e.offsetWidth,c=e.offsetHeight,h=parseInt(e.style.left)||0,d=parseInt(e.style.top)||0,u=(null===(o=this.canvas)||void 0===o?void 0:o.offsetWidth)||0,p=(null===(n=this.canvas)||void 0===n?void 0:n.offsetHeight)||0,v=u-a,f=p-c;document.onmousemove=t=>{this.handleMouseMove(t,s,e,l,r,a,c,h,d,v,f,20,u,p)},document.onmouseup=()=>{var t,e;null===(e=null===(t=this.options)||void 0===t?void 0:t.overlapCallback)||void 0===e||e.call(t,this.areElementsOverlapping(this.canvas)),i&&(i.style.opacity="1"),document.onmousemove=null,document.onmouseup=null}}handleMouseMove(t,e,s,i,o,n,l,r,a,c,h,d,u,p){const v=t.clientX-i,f=t.clientY-o;switch(e){case"hot-square":this.moveSquare(s,r,a,v,f,c,h);break;case"lt":this.resizeLT(s,n,l,r,a,v,f,d,u,p);break;case"lb":this.resizeLB(s,n,l,r,a,v,f,d,u,p);break;case"rt":this.resizeRT(s,n,l,r,a,v,f,d,u,p);break;case"br":this.resizeBR(s,n,l,r,a,v,f,d,u,p);break;case"lm":this.resizeLM(s,n,r,v,d,u);break;case"rm":this.resizeRM(s,n,r,v,d,u);break;case"tm":this.resizeTM(s,l,a,f,d,p);break;case"bm":this.resizeBM(s,l,a,f,d,p)}}moveSquare(t,e,s,i,o,n,l){const r=Math.max(0,Math.min(e+i,n)),a=Math.max(0,Math.min(s+o,l));t.style.left=`${r}px`,t.style.top=`${a}px`}resizeLT(t,e,s,i,o,n,l,r,a,c){let h=e+(n=-n),d=i-n,u=s+(l=-l),p=o-l;h<r&&(h=r,d=i+e-r),d<0&&(d=0,h=e+i),d+h>a&&(h=a-d),u<r&&(u=r,p=o+s-r),p<0&&(p=0,u=s+o),p+u>c&&(u=c-p),t.style.width=`${h}px`,t.style.height=`${u}px`,t.style.left=`${d}px`,t.style.top=`${p}px`}resizeLB(t,e,s,i,o,n,l,r,a,c){let h=e-n,d=i+n,u=s+l;h<r&&(h=r,d=i+(e-r)),d<0&&(d=0,h=e+i),d+h>a&&(h=a-d),u<r&&(u=r),o+u>c&&(u=c-o),t.style.width=`${h}px`,t.style.left=`${d}px`,t.style.height=`${u}px`}resizeRT(t,e,s,i,o,n,l,r,a,c){let h=e+n,d=s+(l=-l),u=o-l;h<r&&(h=r),i+h>a&&(h=a-i),d<r&&(d=r,u=o+s-r),u<0&&(u=0,d=s+o),u+d>c&&(d=c-u),t.style.width=`${h}px`,t.style.height=`${d}px`,t.style.top=`${u}px`}resizeBR(t,e,s,i,o,n,l,r,a,c){let h=e+n,d=s+l;h<r&&(h=r),i+h>a&&(h=a-i),d<r&&(d=r),o+d>c&&(d=c-o),t.style.width=`${h}px`,t.style.height=`${d}px`}resizeLM(t,e,s,i,o,n){let l=e-i,r=s+i;l<o&&(l=o,r=s+(e-o)),r<0&&(r=0,l=e+s),r+l>n&&(l=n-r),t.style.width=`${l}px`,t.style.left=`${r}px`}resizeRM(t,e,s,i,o,n){let l=e+i;l<o&&(l=o),s+l>n&&(l=n-s),t.style.width=`${l}px`}resizeTM(t,e,s,i,o,n){let l=e+(i=-i),r=s-i;l<o&&(l=o,r=s+e-o),r<0&&(r=0,l=e+s),r+l>n&&(l=n-r),t.style.height=`${l}px`,t.style.top=`${r}px`}resizeBM(t,e,s,i,o,n){let l=e+i;l<o&&(l=o),s+l>n&&(l=n-s),t.style.height=`${l}px`}uploadHotImg(t){return new Promise(((e,s)=>{var i;const o=new Image;o.src=t,o.style.cssText="position:absolute;left:0;top:0;opacity:0",null===(i=this.container)||void 0===i||i.appendChild(o),o.onload=()=>{this.scaleCalc(o.offsetWidth,o.offsetHeight,t,e),o.remove()},o.onerror=()=>{o.remove(),s(new Error("Image load error"))}}))}scaleCalc(t,e,s,i){var o,n;if(this.isInit||this.resetInit(),!this.container||!this.canvas)return;const{offsetWidth:l,offsetHeight:r}=this.container,a=t/e,c=l/r;let h;h="auto"===this.options.scaleMode&&t<l&&e<r?1:a>c?l/t:r/e,this.canvas.style.cssText=`\n        position: absolute;\n        width: ${t*h}px;\n        height: ${e*h}px;\n        background-image: url(${s});\n        left: 50%;\n        top: 50%;\n        transform: translate(-50%, -50%);\n        background-size: contain;\n        background-repeat: no-repeat;\n        background-position: center;\n        box-sizing: border-box;\n        border: 1px dashed #ccc;\n      `;const d=(null===(n=null===(o=this.options)||void 0===o?void 0:o.style)||void 0===n?void 0:n.canvas)||{};Object.keys(d).forEach((t=>{this.canvas&&(this.canvas.style[t]=d[t])})),this.scale=h,this.hotImgWidth=t*h,this.hotImgHeight=e*h,i({w:this.hotImgWidth,h:this.hotImgHeight,scale:this.scale})}destroy(){var t,e,s;null===(t=this.container)||void 0===t||t.querySelectorAll(".hot-square").forEach((t=>t.remove())),null===(e=this.canvas)||void 0===e||e.remove(),this.canvas=null,this.isInit=!1,null===(s=this.container)||void 0===s||s.removeEventListener("mousedown",this.handleMouseDownFunc)}getMaxZIndex(){var t;const e=null===(t=this.container)||void 0===t?void 0:t.querySelectorAll(".hot-square");return(null==e?void 0:e.length)?Math.max(...Array.from(e).map((t=>parseInt(getComputedStyle(t).zIndex)||1))):1}areElementsOverlapping(t=this.canvas){if(!t)return!1;const e=t.querySelectorAll(".hot-square"),s=e.length;for(let t=0;t<s;t++){const i=e[t].getBoundingClientRect();for(let o=t+1;o<s;o++){const t=e[o].getBoundingClientRect();if(!(t.left>i.right||t.right<i.left||t.top>i.bottom||t.bottom<i.top))return!0}}return!1}getHotAreaData(t="array"){const e=this.container.querySelectorAll(".hot-square");return Array.from(e).reduce(((e,s)=>{const i=s.querySelector(".hot-seq");if(!i)return e;const o=parseInt(i.innerText)-1,n=parseFloat(s.style.left||"0"),l=parseFloat(s.style.top||"0");if("array"===t){const t=e;return o<t.length?t[o]={x:n,y:l,w:s.offsetWidth,h:s.offsetHeight,index:o}:console.warn(`Index ${o} exceeds array length`),t}{const t=e;return t[o]={x:n,y:l,w:s.offsetWidth,h:s.offsetHeight,index:o},t}}),"array"===t?[]:{})}}}));
